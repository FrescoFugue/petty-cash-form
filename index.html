<script>
document.addEventListener("DOMContentLoaded", () => {

  const itemsContainer = document.getElementById("itemsContainer");
  const totalAmountInput = document.getElementById("totalAmount");
  const form = document.getElementById("pettyForm");

  function addItem() {
    const row = document.createElement("div");
    row.className = "flex gap-2";

    row.innerHTML = `
      <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
        class="flex-1 rounded-lg border border-slate-300 px-3 py-2" />
      <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
        class="w-32 rounded-lg border border-slate-300 px-3 py-2 item-amount" />
      <button type="button" class="text-red-500">üóë</button>
    `;

    row.querySelector("button").onclick = () => {
      row.remove();
      calculateTotal();
    };

    row.querySelector(".item-amount").oninput = calculateTotal;

    itemsContainer.appendChild(row);
  }

  function calculateTotal() {
    let total = 0;
    document.querySelectorAll(".item-amount").forEach(input => {
      total += Number(input.value || 0);
    });
    totalAmountInput.value = total;
  }

  addItem();

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const items = [];
    itemsContainer.querySelectorAll("div").forEach(row => {
      const inputs = row.querySelectorAll("input");
      if (inputs[0].value && inputs[1].value) {
        items.push({
          name: inputs[0].value,
          amount: Number(inputs[1].value)
        });
      }
    });

    if (items.length === 0) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
      return;
    }

    const payload = {
      requester

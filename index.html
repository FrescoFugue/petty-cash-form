<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏¢‡πà‡∏≠‡∏¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center p-4">

<div class="w-full max-w-xl bg-white rounded-2xl shadow-lg p-6">
  <h2 class="text-2xl font-semibold text-slate-800 mb-6">
    ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏¢‡πà‡∏≠‡∏¢
  </h2>

  <form id="pettyForm" class="space-y-4">

    <!-- ‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">
        ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ö‡∏¥‡∏Å
      </label>
      <input
        name="requester"
        required
        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ"
        class="w-full rounded-lg border border-slate-300 px-3 py-2"
      />
    </div>

    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å -->
    <div>
      <div class="flex justify-between items-center mb-2">
        <label class="text-sm font-medium text-slate-700">
          ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å
        </label>
        <button
          type="button"
          onclick="addItem()"
          class="text-sm text-blue-600 hover:underline"
        >
          ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </button>
      </div>

      <div id="itemsContainer" class="space-y-2">
        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô -->
      </div>
    </div>

    <!-- ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° -->
    <div>
      <label class="block text-sm font-medium text-slate-700 mb-1">
        ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)
      </label>
      <input
        type="number"
        id="totalAmount"
        name="amount"
        readonly
        class="w-full rounded-lg border border-slate-300 bg-slate-100 px-3 py-2"
      />
    </div>

    <button
      type="submit"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 rounded-lg"
    >
      ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏ö‡∏¥‡∏Å
    </button>

  </form>

  <p class="text-xs text-slate-400 text-center mt-4">
    ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ö‡∏¥‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏¢‡πà‡∏≠‡∏¢ ‚Ä¢ Powered by n8n
  </p>
</div>

<script>
  const SECRET = "PCASH_2025_SECRET";
  const itemsContainer = document.getElementById("itemsContainer");
  const totalAmountInput = document.getElementById("totalAmount");

  function addItem(name = "", amount = "") {
    const row = document.createElement("div");
    row.className = "flex gap-2";

    row.innerHTML = `
      <input
        type="text"
        placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£"
        class="flex-1 rounded-lg border border-slate-300 px-3 py-2"
      />
      <input
        type="number"
        placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô"
        class="w-32 rounded-lg border border-slate-300 px-3 py-2 item-amount"
        oninput="calculateTotal()"
      />
      <button
        type="button"
        onclick="removeItem(this)"
        class="text-red-500 hover:text-red-700"
      >
        üóë
      </button>
    `;

    itemsContainer.appendChild(row);
  }

  function removeItem(btn) {
    btn.parentElement.remove();
    calculateTotal();
  }

  function calculateTotal() {
    let total = 0;
    document.querySelectorAll(".item-amount").forEach(input => {
      total += Number(input.value || 0);
    });
    totalAmountInput.value = total;
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏° 1 ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
  addItem();

  document.getElementById("pettyForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const items = [];
    itemsContainer.querySelectorAll("div").forEach(row => {
      const inputs = row.querySelectorAll("input");
      const name = inputs[0].value;
      const amount = Number(inputs[1].value || 0);
      if (name && amount > 0) {
        items.push({ name, amount });
      }
    });

    if (items.length === 0) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
      return;
    }

    const formData = new FormData();
    formData.append("requester", e.target.requester.value);
    formData.append("items", JSON.stringify(items));
    formData.append("amount", totalAmountInput.value);
    formData.append("secret", SECRET);

    try {
      const res = await fetch(
        "https://n8n-zh10.onrender.com/webhook/petty-cash",
        {
          method: "POST",
          body: formData,
        }
      );

      if (!res.ok) throw new Error("submit failed");

      alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
      e.target.reset();
      itemsContainer.innerHTML = "";
      addItem();
      calculateTotal();
    } catch (err) {
      alert("‚ùå ‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
      console.error(err);
    }
  });
</script>

</body>
</html>
